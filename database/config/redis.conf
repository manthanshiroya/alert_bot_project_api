# Redis Configuration File for Alert Bot Project
# Optimized for caching, session storage, and real-time data

################################## NETWORK #####################################

# Accept connections on all interfaces
bind 0.0.0.0

# Accept connections on the specified port
port 6379

# TCP listen() backlog
tcp-backlog 511

# Close the connection after a client is idle for N seconds (0 to disable)
timeout 300

# TCP keepalive
tcp-keepalive 300

################################# TLS/SSL ######################################

# TLS/SSL is disabled by default
# tls-port 0
# tls-cert-file redis.crt
# tls-key-file redis.key

################################# GENERAL #####################################

# Run as a daemon
daemonize no

# Set server verbosity to 'notice'
loglevel notice

# Specify the log file name
logfile "/var/log/redis/redis.log"

# Set the number of databases
databases 16

# Show Redis logo on startup
always-show-logo no

# Set the server verbosity to 'notice'
set-proc-title yes
proc-title-template "{title} {listen-addr} {server-mode}"

################################ SNAPSHOTTING  ################################

# Save the DB to disk
# Format: save <seconds> <changes>
save 900 1      # Save if at least 1 key changed in 900 seconds
save 300 10     # Save if at least 10 keys changed in 300 seconds
save 60 10000   # Save if at least 10000 keys changed in 60 seconds

# Compress string objects using LZF when dump .rdb databases
rdbcompression yes

# Checksum the RDB file
rdbchecksum yes

# The filename where to dump the DB
dbfilename dump.rdb

# Remove RDB files used by replication in instances without persistence
rdb-del-sync-files no

# The working directory
dir /data

################################# REPLICATION #################################

# Master-Replica replication settings (if needed)
# replicaof <masterip> <masterport>
# masterauth <master-password>
# replica-serve-stale-data yes
# replica-read-only yes
# repl-diskless-sync no
# repl-diskless-sync-delay 5
# repl-diskless-load disabled
# repl-ping-replica-period 10
# repl-timeout 60
# repl-disable-tcp-nodelay no
# repl-backlog-size 1mb
# repl-backlog-ttl 3600
# replica-priority 100
# min-replicas-to-write 3
# min-replicas-max-lag 10

################################## SECURITY ###################################

# Require clients to issue AUTH <PASSWORD> before processing any other commands
# requirepass your_redis_password_here

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command PEXPIRE ""
rename-command DEL ""
rename-command CONFIG "CONFIG_b840fc02d524045429941cc15f59e41cb7be6c52"
rename-command SHUTDOWN "SHUTDOWN_b840fc02d524045429941cc15f59e41cb7be6c52"
rename-command DEBUG "DEBUG_b840fc02d524045429941cc15f59e41cb7be6c52"
rename-command EVAL ""

# ACL (Access Control List) settings
# aclfile /etc/redis/users.acl

################################### CLIENTS ####################################

# Set the max number of connected clients
maxclients 10000

################################## MEMORY MANAGEMENT #########################

# Set a memory usage limit
maxmemory 512mb

# Memory policy when max memory is reached
maxmemory-policy allkeys-lru

# LRU, LFU and minimal TTL algorithms are not precise algorithms
maxmemory-samples 5

# Evict expired keys
active-expire-effort 1

############################# LAZY FREEING ####################################

# Lazy freeing of memory
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
lazyfree-lazy-user-del no
lazyfree-lazy-user-flush no

############################ KERNEL OOM CONTROL ##############################

# OOM score adjustment
oom-score-adj no
oom-score-adj-values 0 200 800

#################### KERNEL TRANSPARENT HUGEPAGE CONTROL ######################

# Disable transparent huge pages
disable-thp yes

############################## APPEND ONLY FILE ###############################

# Enable append only file
appendonly yes

# The name of the append only file
appendfilename "appendonly.aof"

# Fsync policy
appendfsync everysec

# Don't fsync during rewrites
no-appendfsync-on-rewrite no

# Auto rewrite the append only file
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Load truncated AOF file on startup
aof-load-truncated yes

# Use RDB-AOF hybrid persistence
aof-use-rdb-preamble yes

# AOF rewrite incremental fsync
aof-rewrite-incremental-fsync yes

# RDB save incremental fsync
rdb-save-incremental-fsync yes

################################ LUA SCRIPTING  ###############################

# Max execution time for Lua scripts in milliseconds
lua-time-limit 5000

################################ REDIS CLUSTER  ###############################

# Cluster mode disabled for single instance
# cluster-enabled no
# cluster-config-file nodes-6379.conf
# cluster-node-timeout 15000
# cluster-replica-validity-factor 10
# cluster-migration-barrier 1
# cluster-require-full-coverage yes
# cluster-replica-no-failover no
# cluster-allow-reads-when-down no

########################## CLUSTER DOCKER/NAT support  ########################

# cluster-announce-ip 10.1.1.5
# cluster-announce-port 6379
# cluster-announce-bus-port 6380

################################## SLOW LOG ###################################

# Log queries slower than specified microseconds
slowlog-log-slower-than 10000

# Maximum length of slow log
slowlog-max-len 128

################################ LATENCY MONITOR ##############################

# Enable latency monitoring
latency-monitor-threshold 100

############################# EVENT NOTIFICATION ##############################

# Keyspace notifications
notify-keyspace-events "Ex"

############################### ADVANCED CONFIG ###############################

# Hash table settings
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List settings
list-max-ziplist-size -2
list-compress-depth 0

# Set settings
set-max-intset-entries 512

# Sorted set settings
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog settings
hll-sparse-max-bytes 3000

# Streams settings
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing
activerehashing yes

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Client query buffer limit
client-query-buffer-limit 1gb

# Protocol buffer limit
proto-max-bulk-len 512mb

# Frequency of rehashing
hz 10

# Enable dynamic HZ
dynamic-hz yes

# AOF rewrite buffer limit
aof-rewrite-incremental-fsync yes

# RDB save incremental fsync
rdb-save-incremental-fsync yes

# Jemalloc background thread
jemalloc-bg-thread yes

# Hash function for hash slots
# hash-function crc16

################################## INCLUDES ###################################

# Include other config files if needed
# include /path/to/local.conf
# include /path/to/other.conf

################################## MODULES ####################################

# Load modules at startup
# loadmodule /path/to/my_module.so
# loadmodule /path/to/other_module.so arg1 arg2

################################## CUSTOM #####################################

# Custom configurations for Alert Bot Project

# Optimize for session storage and caching
timeout 0
tcp-keepalive 60

# Optimize for pub/sub
client-output-buffer-limit pubsub 256mb 64mb 60

# Enable keyspace notifications for cache invalidation
notify-keyspace-events "KEA"

# Optimize memory usage
maxmemory-samples 10
active-expire-effort 3

# Performance tuning
hz 25
dynamic-hz yes

# Security enhancements
protected-mode yes

# Logging optimizations
syslog-enabled no
syslog-ident redis
syslog-facility local0

# Connection optimizations
tcp-backlog 2048

# Memory optimizations for small objects
hash-max-ziplist-entries 1024
hash-max-ziplist-value 128
list-max-ziplist-size -1
set-max-intset-entries 1024
zset-max-ziplist-entries 256
zset-max-ziplist-value 128